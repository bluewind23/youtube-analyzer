<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ settings.title_text }}</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5809883478660758"
        crossorigin="anonymous"></script>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%234F46E5%22></rect><polygon points=%2240,30 70,50 40,70%22 fill=%22%23ffffff%22></polygon></svg>">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --primary-color: #4F46E5;
            --secondary-color: #10B981;
            --bg-color: #F1F5F9;
            --card-bg-color: #ffffff;
            --text-color: #4B5563;
            --subtle-text-color: #6B7280;
            --border-color: #E5E7EB;
            --sorted-col-bg: #EEF2FF;
            --error-color: #d63031;
        }

        html,
        body {
            height: 100%;
            margin: 0;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0 0 0;
            box-sizing: border-box;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: var(--card-bg-color);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
            width: 95%;
            flex-grow: 1;
        }

        h2 {
            font-size: 32px;
            font-weight: 800;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0;
            margin-bottom: 30px;
        }

        h2 a {
            text-decoration: none;
            color: inherit;
            display: flex;
            align-items: center;
        }

        h2 img {
            max-height: 40px;
            width: auto;
        }

        .search-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        input,
        select,
        button {
            font-family: inherit;
            font-size: 16px;
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            outline: none;
            transition: all 0.2s;
        }

        input[type="text"] {
            flex-grow: 1;
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, .15);
        }

        #apiKeyInput {
            text-align: center;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        button:disabled {
            background-color: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
        }

        .button-secondary {
            background-color: var(--subtle-text-color);
        }

        .history-tag {
            display: inline-block;
            background-color: #eef2f6;
            padding: 4px 12px;
            border-radius: 15px;
            margin: 4px;
            font-size: 13px;
            cursor: pointer;
        }

        .search-history {
            margin-top: 10px;
            min-height: 28px;
            text-align: center;
        }

        .api-explainer {
            font-size: 14px;
            color: var(--subtle-text-color);
            margin-top: 20px;
            background-color: #F9FAFB;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #dfe4ea;
            line-height: 1.8;
            text-align: center;
        }

        .api-explainer p {
            margin: 10px 0;
            text-align: center;
        }

        .api-explainer strong {
            color: var(--text-color);
            font-weight: 600;
        }

        .api-explainer a {
            font-weight: 600;
            color: var(--primary-color);
            text-decoration: none;
            font-size: 1.1em;
        }

        .api-explainer a:hover {
            text-decoration: underline;
        }

        #pre-search-ad-container,
        .ad-container {
            width: 100%;
            min-height: 90px;
            background-color: #f0f2f5;
            border: 1px dashed var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--subtle-text-color);
            box-sizing: border-box;
        }

        #pre-search-ad-container {
            display: none;
            margin: 25px auto;
            width: 728px;
            height: 90px;
        }

        .ad-container {
            margin: 10px 0;
        }

        #results-container.grid-view .ad-card {
            grid-column: 1 / -1;
        }

        .ad-row .ad-cell {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .ad-row .ad-container {
            margin: 0;
        }


        .filter-controls {
            display: none;
            justify-content: flex-end;
            align-items: center;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .filter-controls .right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-controls .right span,
        .filter-controls .right select {
            font-size: 13px;
        }

        .filter-controls .right select {
            width: auto;
            min-width: 90px;
            padding: 8px 28px 8px 12px;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }

        #view-toggle-btn {
            background: none;
            border: 1px solid var(--border-color);
            width: 36px;
            height: 36px;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        #view-toggle-btn svg {
            width: 22px;
            height: 22px;
            fill: #6b7280;
        }

        #results-container {
            overflow-x: auto;
            text-align: left;
        }

        #results-container.grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            overflow-x: hidden;
        }

        .grid-view .video-card {
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--card-bg-color);
        }

        .grid-view .video-card .thumbnail-container {
            width: 100%;
            height: auto;
            padding-top: 56.25%;
            position: relative;
            flex-shrink: 0;
        }

        .grid-view .video-card .thumbnail-container img {
            position: absolute;
            top: 0;
            left: 0;
        }

        .grid-view .video-card .info-main {
            flex-grow: 1;
            text-align: left;
            padding: 12px;
        }

        .grid-view .video-card .video-title {
            white-space: normal;
            height: 42px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .grid-view .video-card .stat-grid {
            display: flex;
            justify-content: space-around;
            font-size: 13px;
            padding: 8px 12px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--subtle-text-color);
        }

        .grid-view .video-card .stat-grid b {
            color: var(--text-color);
        }

        .download-icon-grid {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            opacity: 0;
        }

        .video-card:hover .download-icon-grid {
            opacity: 1;
        }

        .download-icon-grid:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .download-icon-grid svg {
            width: 18px;
            height: 18px;
            fill: #ffffff;
        }

        #results-container .loader {
            display: block;
            text-align: center;
            padding: 100px 0;
            font-size: 20px;
            font-weight: 500;
            grid-column: 1 / -1;
        }

        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 15px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #results-container .message {
            display: block;
            text-align: center;
            padding: 100px 0;
            font-size: 20px;
            font-weight: 500;
            grid-column: 1 / -1;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            border: 1px solid var(--border-color);
        }

        .video-card-row:hover {
            background-color: #F5F5F5;
        }

        .list-header {
            font-size: 13px;
            font-weight: 600;
            color: var(--subtle-text-color);
        }

        .list-header th {
            padding: 10px 12px;
            border-bottom: 2px solid #333;
            cursor: pointer;
        }

        .list-header th.active {
            background-color: var(--sorted-col-bg);
        }

        .header-item-content {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 5px;
        }

        .list-header th .arrow {
            opacity: 0.8;
        }

        .h-rank {
            width: 45px;
            text-align: center;
        }

        .h-info {
            text-align: left;
        }

        .h-stat {
            width: 110px;
            text-align: right;
        }

        .h-download {
            width: 100px;
            cursor: default;
            text-align: center;
        }

        .cell {
            vertical-align: middle;
            padding: 12px 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .download-cell {
            text-align: center;
        }

        .rank {
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: var(--subtle-text-color);
        }

        .info-cell {
            display: flex;
            align-items: center;
            text-align: left;
        }

        .thumbnail-container {
            position: relative;
            flex-shrink: 0;
            width: 120px;
            height: 67px;
            border-radius: 6px;
            overflow: hidden;
        }

        .thumbnail-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-main {
            padding: 0 15px;
            min-width: 0;
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 4px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .video-title a {
            color: var(--text-color);
            text-decoration: none;
        }

        .video-title a:hover {
            color: var(--primary-color);
        }

        .channel-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .channel-title {
            font-size: 14px;
            color: var(--subtle-text-color);
            cursor: pointer;
            text-decoration: none;
        }

        .stat {
            text-align: right;
            font-size: 15px;
        }

        .stat .rate {
            font-size: 0.9em;
            color: var(--secondary-color);
        }

        .download-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 34px;
            height: 34px;
        }

        .download-icon svg {
            width: 20px;
            height: 20px;
            fill: var(--subtle-text-color);
        }

        #recommend-tags-section {
            box-sizing: border-box;
            width: 100%;
        }

        .recommend-tags-container {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: left;
        }

        .recommend-tags-container h4 {
            margin: 0 0 10px 0;
            font-size: 15px;
            font-weight: 600;
        }

        .recommend-tags-container .tag {
            display: inline-block;
            cursor: pointer;
            transition: background-color 0.2s;
            background: #eef2f6;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }

        .recommend-tags-container .tag:hover {
            background-color: #dcebfd;
        }

        .tag-copy-notification {
            position: fixed;
            background-color: white;
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            font-size: 13px;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            pointer-events: none;
        }

        .tag-copy-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .action-buttons {
            position: absolute;
            right: 15px;
            bottom: 10px;
            display: flex;
            gap: 10px;
        }

        .secondary-action-btn {
            font-size: 12px;
            padding: 5px 10px;
            font-weight: 500;
            color: var(--subtle-text-color);
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .secondary-action-btn:hover {
            background-color: #eef2f6;
            color: var(--text-color);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 25px;
        }

        .pagination button {
            font-size: 14px;
            padding: 6px 12px;
            min-width: auto;
            height: auto;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            text-align: left;
            width: 90%;
            max-width: 600px;
            transform: translateY(-20px);
            transition: transform 0.3s;
            margin: auto;
            display: flex;
            flex-direction: column;
            max-height: 85vh;
        }

        .modal-content[data-scrollable="true"] {
            padding: 0;
        }

        .modal-header {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .guide-content {
            padding: 20px 30px;
            overflow-y: auto;
            flex-grow: 1;
            min-height: 0;
        }

        .modal-body {
            padding: 20px 30px 30px;
        }

        .modal-header h3 {
            margin: 0;
            flex-grow: 1;
        }

        .modal-header .modal-close-btn {
            position: static;
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }

        .modal-content h3 {
            margin-top: 0;
            font-weight: 700;
            font-size: 22px;
            text-align: center;
        }

        .modal-content p {
            margin-bottom: 20px;
            color: var(--subtle-text-color);
            line-height: 1.6;
        }

        #api-key-error {
            color: var(--error-color);
            font-size: 14px;
            margin-bottom: 10px;
            display: none;
            font-weight: 500;
        }

        .modal-content p a {
            color: var(--primary-color);
            font-weight: 500;
        }

        .modal-content input {
            width: 100%;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #888;
        }

        .modal-content textarea {
            width: 100%;
            box-sizing: border-box;
            min-height: 100px;
            padding: 10px;
            font-family: inherit;
            font-size: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: vertical;
            margin-bottom: 15px;
        }

        #char-counter {
            font-size: 12px;
            color: var(--subtle-text-color);
            text-align: right;
            display: block;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        .guide-step {
            margin-bottom: 25px;
        }

        .guide-step h4,
        .guide-section h4 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 8px;
        }

        .guide-step p,
        .guide-section p {
            margin-top: 0;
        }

        .guide-step b,
        .guide-step strong,
        .guide-section code {
            color: var(--primary-color);
        }

        .guide-image {
            width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-top: 15px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .guide-image:hover {
            transform: scale(1.02);
        }

        .page-footer {
            text-align: center;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--subtle-text-color);
            flex-shrink: 0;
            width: 100%;
            box-sizing: border-box;
            background-color: var(--bg-color);
        }

        .page-footer a {
            color: var(--subtle-text-color);
            font-weight: 500;
            text-decoration: none;
        }

        .page-footer a:hover {
            text-decoration: underline;
            color: var(--primary-color);
        }

        .page-footer .separator {
            margin: 0 10px;
        }

        /* ê¸°ì¡´ .notification-modal, .notification-modal.show, .notification-modal.success, .notification-modal.error ìŠ¤íƒ€ì¼ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ì•„ë˜ ì½”ë“œë¡œ êµì²´ */
        .notification-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 2000;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
            visibility: hidden;
            pointer-events: none;
        }

        .notification-modal.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            visibility: visible;
        }

        .notification-modal.success {
            background-color: var(--primary-color);
        }

        .notification-modal.error {
            background-color: var(--error-color);
        }

        .custom-tooltip {
            position: absolute;
            background-color: #fff;
            color: #212529;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            font-size: 13px;
            line-height: 1.6;
            z-index: 1010;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
            border: 1px solid #e5e7eb;
            transform: translateY(5px);
        }

        .custom-tooltip.show {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        .custom-tooltip .tooltip-arrow {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #fff;
            transform: rotate(45deg);
            bottom: -6px;
            left: 50%;
            margin-left: -5px;
            border-bottom: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
        }

        #tooltip-content h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: 600;
            color: #212529;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 5px;
            text-align: center;
        }

        #tooltip-content p {
            margin: 0 0 4px 0;
            color: #6a6a6a;
        }

        #image-lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            cursor: pointer;
        }

        #image-lightbox.show {
            display: flex;
        }

        #image-lightbox img {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            cursor: default;
        }

        #metrics-guide-modal .guide-content {
            text-align: center;
        }

        /* âœ¨ ì˜ˆìœ ì˜¤ë¥˜ ê²½ê³ ì°½ ìŠ¤íƒ€ì¼ ì¶”ê°€ âœ¨ */
        .error-modal-content {
            background-color: #f8f9fa;
            color: var(--text-color);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 480px;
            text-align: center;
            border-top: 5px solid var(--error-color);
            overflow: hidden;
        }

        .error-modal-header {
            padding: 20px 30px 10px;
        }

        .error-modal-header .error-icon {
            font-size: 40px;
            line-height: 1;
        }

        .error-modal-header h3 {
            margin: 10px 0 0 0;
            font-size: 22px;
            color: var(--text-color);
        }

        .error-modal-body {
            padding: 0 30px 20px;
        }

        .error-modal-body p {
            margin: 0;
            font-size: 16px;
            line-height: 1.7;
            color: var(--subtle-text-color);
        }

        .error-modal-body p a {
            color: var(--primary-color);
            font-weight: 600;
            text-decoration: none;
        }

        .error-modal-body p a:hover {
            text-decoration: underline;
        }

        .error-modal-footer {
            background-color: #e9ecef;
            padding: 15px 30px;
        }

        .error-modal-footer button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <div id="image-lightbox" onclick="closeImageLightbox()">
        <img src="" alt="í™•ëŒ€ëœ ê°€ì´ë“œ ì´ë¯¸ì§€" onclick="event.stopPropagation()">
    </div>
    <div id="custom-tooltip" class="custom-tooltip">
        <div id="tooltip-content"></div>
        <div class="tooltip-arrow"></div>
    </div>
    <div id="notification-modal"></div>

    <div id="error-modal" class="modal-overlay">
        <div class="error-modal-content">
            <div class="error-modal-header">
                <div class="error-icon">âš ï¸</div>
                <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
            </div>
            <div class="error-modal-body">
                <p id="error-modal-message"></p>
            </div>
            <div class="error-modal-footer">
                <button onclick="closeErrorModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="api-key-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API í‚¤ ë“±ë¡</h3>
                <button class="modal-close-btn" onclick="closeApiKeyModal()">Ã—</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <p>YouTube Data API v3 í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>í‚¤ ë°œê¸‰ ë°©ë²•ì€ <a href="#" onclick="openApiGuide(event)">ê°€ì´ë“œ í˜ì´ì§€</a>ë¥¼
                    ì°¸ê³ í•˜ì„¸ìš”.</p>
                <p id="api-key-error"></p>
                <input type="password" id="apiKeyInput" placeholder="API í‚¤ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”">
                <div class="modal-actions">
                    <button class="button-secondary" onclick="closeApiKeyModal()">ë‹«ê¸°</button>
                    <button onclick="saveApiKey()">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>
    <div id="api-guide-modal" class="modal-overlay">
        <div class="modal-content" data-scrollable="true">
            <div class="modal-header">
                <h3>ğŸ”‘ YouTube API í‚¤ ë°œê¸‰ ë°©ë²•</h3>
                <button class="modal-close-btn" onclick="closeApiGuide()">Ã—</button>
            </div>
            <div class="guide-content">
                <div class="guide-step">
                    <h4>1ë‹¨ê³„: Google Cloud Platform ì ‘ì† ë° ì•½ê´€ ë™ì˜</h4>
                    <p><a href="https://console.cloud.google.com/apis/api/youtube.googleapis.com/metrics?inv=1&invt=Ab1erg&project=ttsproject"
                            target="_blank">Google Cloud Platform ë§í¬</a>ì— ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸ í›„, ì„œë¹„ìŠ¤ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.</p><img
                        src="{{ url_for('static', filename='images/guide_step_1.png') }}" alt="1ë‹¨ê³„: GCP ì ‘ì†"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>2ë‹¨ê³„: API ê²€ìƒ‰</h4>
                    <p>ë¡œê·¸ì¸ í›„, í™”ë©´ ìƒë‹¨ì˜ ê²€ìƒ‰ì°½ì— 'youtube api'ë¥¼ ê²€ìƒ‰í•˜ê³  ê²°ê³¼ì—ì„œ <b>'YouTube Data API v3'</b>ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p><img
                        src="{{ url_for('static', filename='images/guide_step_2.png') }}" alt="2ë‹¨ê³„: API ê²€ìƒ‰"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>3ë‹¨ê³„: API ì‚¬ìš© ì„¤ì •</h4>
                    <p>'YouTube Data API v3' í˜ì´ì§€ì—ì„œ íŒŒë€ìƒ‰ <b>'ì‚¬ìš©'</b> ë²„íŠ¼ì„ ì„ íƒí•˜ì—¬ APIë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.</p><img
                        src="{{ url_for('static', filename='images/guide_step_3.png') }}" alt="3ë‹¨ê³„: API ì‚¬ìš© ì„¤ì •"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>4ë‹¨ê³„: API í‚¤ ìƒì„±</h4>
                    <p>ì¢Œì¸¡ ë©”ë‰´ì—ì„œ <b>'ì‚¬ìš©ì ì¸ì¦ ì •ë³´'</b>ë¥¼ ëˆ„ë¥¸ í›„, ìƒë‹¨ì˜ <b>'+ ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°'</b>ë¥¼ í´ë¦­í•˜ê³  <b>'API í‚¤'</b>ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p>
                    <img src="{{ url_for('static', filename='images/guide_step_4.png') }}" alt="4ë‹¨ê³„: API í‚¤ ìƒì„±"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>5ë‹¨ê³„: API í‚¤ ë³µì‚¬ ë° ë³´ê´€</h4>
                    <p>ìƒì„±ëœ API í‚¤ê°€ íŒì—…ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ë©´, ìš°ì¸¡ì˜ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ í‚¤ë¥¼ ë³µì‚¬í•œ í›„ ì•ˆì „í•œ ê³³ì— ë”°ë¡œ ì €ì¥í•´ë‘ì„¸ìš”.<br><strong>âš ï¸ ê²½ê³ : ì´ API í‚¤ëŠ” ë¹„ë°€ë²ˆí˜¸ì™€
                            ê°™ìŠµë‹ˆë‹¤. ì ˆëŒ€ë¡œ ì™¸ë¶€ì— ìœ ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”!</strong></p><img
                        src="{{ url_for('static', filename='images/guide_step_5.png') }}" alt="5ë‹¨ê³„: API í‚¤ ë³µì‚¬"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>6ë‹¨ê³„: API í‚¤ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™</h4>
                    <p>íŒì—…ì„ ë‹«ê³  'ì‚¬ìš©ì ì¸ì¦ ì •ë³´' í˜ì´ì§€ì— ë³´ì´ëŠ” <b>'API í‚¤ 1ê°œ'</b> ë²„íŠ¼ì„ ì„ íƒí•˜ì—¬ í‚¤ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p><img
                        src="{{ url_for('static', filename='images/guide_step_6.png') }}" alt="6ë‹¨ê³„: API í‚¤ ì„¤ì • ì´ë™"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>7ë‹¨ê³„: IP ì£¼ì†Œë¡œ í‚¤ ì œí•œ (ë³´ì•ˆ ê°•í™”)</h4>
                    <p> 'í‚¤ ì œí•œì‚¬í•­' ì„¹ì…˜ì—ì„œ <b>'IP ì£¼ì†Œ'</b>ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ê·¸ í›„ <b>'+ í•­ëª© ì¶”ê°€'</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì‹ ì˜ ê³µì¸ IP ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê³  'ì™„ë£Œ'ë¥¼
                        ëˆ„ë¦…ë‹ˆë‹¤.<br>(ë‚´ IP ì£¼ì†Œë¥¼ ëª¨ë¥¼ ê²½ìš°: <a href="https://www.whatismyip.com/" target="_blank">ì—¬ê¸°ë¥¼ í´ë¦­í•´ì„œ í™•ì¸</a>)
                    </p><img src="{{ url_for('static', filename='images/guide_step_7.png') }}" alt="7ë‹¨ê³„: IP ì£¼ì†Œ ì œí•œ"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>
                <div class="guide-step">
                    <h4>8ë‹¨ê³„: ì €ì¥ ë° ì˜¤ë¥˜ í•´ê²°</h4>
                    <p>í˜ì´ì§€ í•˜ë‹¨ì˜ <b>'ì €ì¥'</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ëª¨ë“  ì„¤ì •ì„ ë§ˆì¹©ë‹ˆë‹¤.<br>ë§Œì•½ ì´ í‚¤ë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ ê²€ìƒ‰ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´, ëŒ€ë¶€ë¶„ 7ë‹¨ê³„ì˜ <b>IP ì£¼ì†Œê°€ ì •í™•í•˜ì§€
                            ì•Šê¸° ë•Œë¬¸</b>ì…ë‹ˆë‹¤. IP ì£¼ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ê³  ì •í™•íˆ ì…ë ¥í•œ í›„ ì €ì¥í•´ì£¼ì„¸ìš”.</p><img
                        src="{{ url_for('static', filename='images/guide_step_8.png') }}" alt="8ë‹¨ê³„: ì €ì¥ ë° ì˜¤ë¥˜ í•´ê²°"
                        class="guide-image" onclick="enlargeImage(this)">
                </div>

                <hr style="margin: 30px 0;">
                <div class="guide-section">
                    <h4 style="color: var(--error-color);">ğŸš¨ API í‚¤ ì‚¬ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë‚˜ìš”?</h4>
                    <p>API í‚¤ë¥¼ ì •í™•íˆ ì…ë ¥í–ˆëŠ”ë°ë„ '403 Forbidden' ë˜ëŠ” 'ì¸ì¦ ì˜¤ë¥˜' ë©”ì‹œì§€ê°€ í‘œì‹œëœë‹¤ë©´, ëŒ€ë¶€ë¶„ ì•„ë˜ 4ê°€ì§€ ê²½ìš° ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.</p>
                    <ol style="padding-left: 20px; line-height: 1.8; text-align: left;">
                        <li><strong>API ë¯¸ì‚¬ìš© ì„¤ì •:</strong> ê°€ì¥ í”í•œ ì‹¤ìˆ˜ì…ë‹ˆë‹¤. Google Cloudì—ì„œ 'YouTube Data API v3' ì‚¬ìš© ì„¤ì •ì„ í•˜ì§€ ì•Šì€
                            ê²½ìš°ì…ë‹ˆë‹¤. <a href="https://console.cloud.google.com/apis/library/youtube.googleapis.com"
                                target="_blank">API ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜ì´ì§€</a>ë¡œ ì´ë™í•˜ì—¬ 'ì‚¬ìš©' ë²„íŠ¼ì´ íŒŒë€ìƒ‰ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ê¼­ í´ë¦­í•´ì£¼ì„¸ìš”.</li>
                        <li><strong>IP ì£¼ì†Œ ë³€ê²½:</strong> API í‚¤ì— IP ì£¼ì†Œ ì œí•œì„ ì„¤ì •í•œ ê²½ìš°, í˜„ì¬ ì ‘ì†í•œ ê³³ì˜ IPê°€ ë°”ë€Œì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a
                                href="https://console.cloud.google.com/apis/credentials" target="_blank">ì‚¬ìš©ì ì¸ì¦ ì •ë³´
                                í˜ì´ì§€</a>ì—ì„œ í˜„ì¬ IPë¥¼ ëª©ë¡ì— ì¶”ê°€í•´ì£¼ì„¸ìš”.</li>
                        <li><strong>ì‚¬ìš©ëŸ‰(ì¿¼í„°) ì´ˆê³¼:</strong> í•˜ë£¨ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì–‘ì„ ëª¨ë‘ ì†Œì§„í•œ ê²½ìš°ì…ë‹ˆë‹¤. í• ë‹¹ëŸ‰ì€ ë³´í†µ <strong>í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ ì˜¤í›„
                                5ì‹œê²½ì— ì´ˆê¸°í™”</strong>ë©ë‹ˆë‹¤.</li>
                        <li><strong>ë‹¤ë¥¸ êµ¬ê¸€ ê³„ì • ì‚¬ìš©:</strong> ì—¬ëŸ¬ êµ¬ê¸€ ê³„ì •ì„ ì‚¬ìš©í•˜ì‹ ë‹¤ë©´, ì§€ê¸ˆ í”„ë¡œê·¸ë¨ì— ì…ë ¥í•œ í‚¤ê°€ ì–´ë–¤ ê³„ì •ì˜ ì–´ë–¤ í”„ë¡œì íŠ¸ì—ì„œ ë°œê¸‰ë˜ì—ˆëŠ”ì§€ ë‹¤ì‹œ
                            í•œë²ˆ í™•ì¸í•´ë³´ì„¸ìš”.</li>
                    </ol>
                </div>

            </div>
        </div>
    </div>
    <div id="metrics-guide-modal" class="modal-overlay">
        <div class="modal-content" data-scrollable="true">
            <div class="modal-header">
                <h3>ğŸ“Š ì§€í‘œ(LVR/CVR)ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</h3>
                <button class="modal-close-btn" onclick="closeMetricsGuide()">Ã—</button>
            </div>
            <div class="guide-content">
                <div class="guide-section">
                    <h4>ì¢‹ì•„ìš” ë¹„ìœ¨ (LVR: Like to View Ratio)</h4>
                    <p><b>ê³„ì‚°ì‹:</b> <code>(ì¢‹ì•„ìš” ìˆ˜ / ì´ì¡°íšŒìˆ˜) * 100</code> <br>ì½˜í…ì¸  ë§Œì¡±ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•µì‹¬ ì§€í‘œ.</p>
                </div>
                <div class="guide-section">
                    <h4>ëŒ“ê¸€ ë¹„ìœ¨ (CVR: Comment to View Ratio)</h4>
                    <p><b>ê³„ì‚°ì‹:</b> <code>(ëŒ“ê¸€ ìˆ˜ / ì´ì¡°íšŒìˆ˜) * 100</code> <br>'ì ê·¹ì ì¸ ì°¸ì—¬ë„'ë¥¼ ë³´ì—¬ì£¼ëŠ” ì§€í‘œ.</p>
                </div>
            </div>
        </div>
    </div>
    <div id="feedback-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>í”¼ë“œë°± ë³´ë‚´ê¸°</h3>
                <button class="modal-close-btn" onclick="closeFeedbackModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p>ì„œë¹„ìŠ¤ ê°œì„ ì„ ìœ„í•œ ì†Œì¤‘í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
                <textarea id="feedback-message" placeholder="ì—¬ê¸°ì— ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="1000"
                    oninput="updateCharCounter()"></textarea>
                <div id="char-counter">0 / 1000</div>
                <div class="modal-actions">
                    <button class="button-secondary" onclick="closeFeedbackModal()">ë‹«ê¸°</button>
                    <button onclick="submitFeedback()">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2><a href="/">{% if settings.logo_path %}<img src="{{ url_for('static', filename=settings.logo_path) }}"
                    alt="Logo">{% else %}{{ settings.title_text }}{% endif %}</a></h2>
        <div class="search-container">
            <div class="controls">
                <input id="query" type="text" />
                <button id="search-btn">ê²€ìƒ‰</button>
                <button id="api-btn">API í‚¤ ë“±ë¡</button>
            </div>
            <div id="api-explainer-container"></div>
            <div id="search-history" class="search-history"></div>
            <div id="pre-search-ad-container">ê´‘ê³  ì˜ì—­</div>
        </div>
        <div class="filter-controls">
            <div class="right">
                <span>í•„í„°:</span>
                <select id="daysFilter" onchange="renderData()">
                    <option value="" disabled selected>ê¸°ê°„</option>
                    <option value="0">ì „ì²´</option>
                    <option value="0.042">1ì‹œê°„ ì „</option>
                    <option value="1">1ì¼ ì „</option>
                    <option value="3">3ì¼ ì „</option>
                    <option value="7">7ì¼ ì „</option>
                    <option value="15">15ì¼ ì „</option>
                    <option value="30">30ì¼ ì „</option>
                </select>
                <select id="subscriberFilter" onchange="renderData()">
                    <option value="" disabled selected>êµ¬ë…ì ìˆ˜</option>
                    <option value="0">ì „ì²´</option>
                    <option value="1000">1ì²œëª… ë¯¸ë§Œ</option>
                    <option value="5000">5ì²œëª… ë¯¸ë§Œ</option>
                    <option value="10000">1ë§Œëª… ë¯¸ë§Œ</option>
                    <option value="30000">3ë§Œëª… ë¯¸ë§Œ</option>
                    <option value="50000">5ë§Œëª… ë¯¸ë§Œ</option>
                    <option value="100000">10ë§Œëª… ë¯¸ë§Œ</option>
                </select>
                <select id="videoTypeFilter" onchange="renderData()">
                    <option value="" disabled selected>ìœ í˜•</option>
                    <option value="all">ì „ì²´</option>
                    <option value="video">ë™ì˜ìƒ</option>
                    <option value="shorts">ì‡¼ì¸ </option>
                </select>
                <select id="itemsPerPage" onchange="changeItemsPerPage()">
                    <option value="" disabled selected>ê²€ìƒ‰ëŸ‰</option>
                    <option value="10">10ê°œì”©</option>
                    <option value="20">20ê°œì”©</option>
                    <option value="30">30ê°œì”©</option>
                    <option value="50">50ê°œì”©</option>
                </select>
                <button id="view-toggle-btn" onclick="toggleViewMode()"></button>
            </div>
        </div>
        <div id="recommend-tags-section" style="display: none;"></div>
        <div id="results-container"></div>
        <div id="pagination-controls" class="pagination"></div>
    </div>

    <footer class="page-footer">
        <span>YouTube ì˜ìƒ ë¶„ì„ íˆ´ v1.0</span>
        <span class="separator">|</span>
        <a href="#" onclick="openFeedbackModal(event)">í”¼ë“œë°± ë³´ë‚´ê¸°</a>
    </footer>

    <script>
        function parseISO8601Duration(duration) {
            if (!duration) return 0;
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            if (!match) return 0;
            const hours = (parseInt(match[1]) || 0);
            const minutes = (parseInt(match[2]) || 0);
            const seconds = (parseInt(match[3]) || 0);
            return hours * 3600 + minutes * 60 + seconds;
        }
        let allResults = [], searchHistory = [], currentPage = 1, itemsPerPage = 50;
        let sortConfig = { key: 'likeCount', direction: 'desc' };
        let currentView = 'list';
        let activeTooltipTarget = null;
        const viewIcons = { list: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3,14H7V10H3M3,19H7V15H3M3,9H7V5H3M9,14H21V10H9M9,19H21V15H9M9,9H21V5H9V9Z" /></svg>`, grid: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3,3V11H11V3M13,3V11H21V3M3,13V21H11V13M13,13V21H21V13" /></svg>` };
        const downloadIconSVG = `<svg viewBox="0 0 24 24" fill="var(--subtle-text-color)"><path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" /></svg>`;

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('search-btn').onclick = searchVideos;
            document.getElementById('api-btn').onclick = showApiKeyModal;
            document.getElementById('query').addEventListener('keydown', e => { if (e.key === 'Enter' && !e.target.disabled) searchVideos(); });
            try {
                searchHistory = JSON.parse(localStorage.getItem('youtubeSearchHistory') || '[]');
                if (!Array.isArray(searchHistory)) { searchHistory = []; }
            } catch (e) { searchHistory = []; }
            currentView = localStorage.getItem('youtubeSearchView') || 'list';
            updateApiKeyUI();

            document.addEventListener('click', (event) => {
                if (activeTooltipTarget && !event.target.closest('.channel-title')) {
                    hideCustomTooltip();
                }
            });
        });

        function updateApiKeyUI() {
            const apiKey = sessionStorage.getItem('youtubeApiKey');
            const queryInput = document.getElementById('query');
            const searchBtn = document.getElementById('search-btn');
            const apiBtn = document.getElementById('api-btn');
            const explainerContainer = document.getElementById('api-explainer-container');
            const filterControls = document.querySelector('.filter-controls');
            const searchHistoryEl = document.getElementById('search-history');
            const adContainer = document.getElementById('pre-search-ad-container');

            if (apiKey) {
                queryInput.disabled = false;
                searchBtn.disabled = false;
                queryInput.placeholder = 'ë¶„ì„í•˜ê³  ì‹¶ì€ í‚¤ì›Œë“œ ì…ë ¥';
                apiBtn.textContent = 'í‚¤ ë³€ê²½';
                if (explainerContainer) explainerContainer.style.display = 'none';
                searchHistoryEl.style.display = 'block';
                adContainer.style.display = 'flex';
                renderSearchHistory();
            } else {
                queryInput.disabled = true;
                searchBtn.disabled = true;
                queryInput.placeholder = 'API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.';
                apiBtn.textContent = 'API í‚¤ ë“±ë¡';
                if (explainerContainer) explainerContainer.style.display = 'block';
                // explainerContainer.innerHTML = ... ì´ ë¶€ë¶„ì„ ì°¾ì•„ ì•„ë˜ ì½”ë“œë¡œ í†µì§¸ë¡œ êµì²´í•´ì£¼ì„¸ìš”.

                if (explainerContainer) explainerContainer.innerHTML = `
    <div class="api-explainer">
        <p><strong>ì´ íˆ´ì€ YouTubeì˜ ê³µì‹ ë°ì´í„° APIë¥¼ í†µí•´ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</strong></p>
        <p>ë”°ë¼ì„œ êµ¬ê¸€ì—ì„œ ë°œê¸‰í•˜ëŠ” ë¬´ë£Œ API í‚¤ë¥¼ ë“±ë¡í•´ì•¼ë§Œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.</p>
        <p style="margin-top: 15px;">API í‚¤ ë°œê¸‰ ë°©ë²•ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”? <a href="#" onclick="openApiGuide(event)" style="font-weight: 600; color: var(--primary-color);">ê°€ì´ë“œ í˜ì´ì§€</a>ì—ì„œ ìì„¸í•œ ë°©ë²•ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
    </div>
`;
                filterControls.style.display = 'none';
                searchHistoryEl.style.display = 'none';
                adContainer.style.display = 'none';
                document.getElementById('results-container').innerHTML = '';
                document.getElementById('pagination-controls').innerHTML = '';
            }
            applyViewMode();
        }

        function showNotification(message, type = 'success') {
            const el = document.getElementById('notification-modal');
            if (el) {
                el.textContent = message;
                el.className = 'notification-modal'; // Reset classes
                el.classList.add(type);
                el.classList.add('show');
                setTimeout(() => {
                    el.classList.remove('show');
                }, 3000);
            }
        }

        // âœ¨ ì˜¤ë¥˜ ê²½ê³ ì°½ ê´€ë ¨ í•¨ìˆ˜ ì¶”ê°€
        function showErrorModal(htmlMessage) {
            document.getElementById('error-modal-message').innerHTML = htmlMessage;
            document.getElementById('error-modal').classList.add('show');
        }
        function closeErrorModal() {
            document.getElementById('error-modal').classList.remove('show');
        }

        function showApiKeyModal() { document.getElementById('api-key-modal').classList.add('show'); }
        function closeApiKeyModal() {
            const errorElement = document.getElementById('api-key-error');
            if (errorElement) errorElement.style.display = 'none';
            document.getElementById('api-key-modal').classList.remove('show');
        }
        function openApiGuide(event) { event.preventDefault(); document.getElementById('api-guide-modal').classList.add('show'); }
        function closeApiGuide() { document.getElementById('api-guide-modal').classList.remove('show'); }
        function openMetricsGuide(event) { event.preventDefault(); document.getElementById('metrics-guide-modal').classList.add('show'); }
        function closeMetricsGuide() { document.getElementById('metrics-guide-modal').classList.remove('show'); }
        function openFeedbackModal(event) { event.preventDefault(); document.getElementById('feedback-modal').classList.add('show'); }
        function closeFeedbackModal() { document.getElementById('feedback-modal').classList.remove('show'); }

        function updateCharCounter() {
            const message = document.getElementById('feedback-message').value;
            const counter = document.getElementById('char-counter');
            counter.textContent = `${message.length} / 1000`;
        }

        async function submitFeedback() {
            const message = document.getElementById('feedback-message').value.trim();
            if (!message) { showNotification("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error"); return; }
            if (message.length > 1000) { showNotification("ë©”ì‹œì§€ëŠ” 1000ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error"); return; }
            const formData = new FormData();
            formData.append('message', message);
            try {
                const response = await fetch('/submit_feedback', { method: 'POST', body: formData });
                const result = await response.json();
                if (result.success) {
                    showNotification(result.message, "success");
                    closeFeedbackModal();
                } else { throw new Error(result.error); }
            } catch (error) { showNotification('ì „ì†¡ ì‹¤íŒ¨: ' + error.message, "error"); }
        }

        async function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const saveButton = document.querySelector('#api-key-modal button:last-child');
            const errorElement = document.getElementById('api-key-error');

            if (!apiKey) {
                errorElement.textContent = 'API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorElement.style.display = 'block';
                return;
            }

            const originalButtonText = saveButton.textContent;
            saveButton.disabled = true;
            saveButton.textContent = 'í™•ì¸ ì¤‘...';
            errorElement.style.display = 'none';

            try {
                const response = await fetch('/validate_key', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey: apiKey })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    sessionStorage.setItem('youtubeApiKey', apiKey);
                    closeApiKeyModal();
                    showNotification("API í‚¤ê°€ ì¸ì¦ ë° ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
                    updateApiKeyUI();
                } else {
                    errorElement.textContent = result.error || 'ìœ íš¨í•˜ì§€ ì•Šì€ API í‚¤ì…ë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    errorElement.style.display = 'block';
                }
            } catch (err) {
                errorElement.textContent = 'ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                errorElement.style.display = 'block';
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = originalButtonText;
            }
        }

        function updateSearchHistory(query) {
            if (!query) return;
            searchHistory = searchHistory.filter(item => item !== query);
            searchHistory.unshift(query);
            if (searchHistory.length > 10) searchHistory.pop();
            localStorage.setItem('youtubeSearchHistory', JSON.stringify(searchHistory));
            renderSearchHistory();
        }

        function renderSearchHistory() {
            const searchHistoryEl = document.getElementById('search-history');
            if (searchHistoryEl) {
                searchHistoryEl.innerHTML = searchHistory.map(term => `<span class="history-tag" onclick="document.getElementById('query').value='${term}'; searchVideos();">${term}</span>`).join('');
            }
        }

        async function searchVideos() {
            const query = document.getElementById("query").value.trim();
            const apiKey = sessionStorage.getItem('youtubeApiKey');
            const resultsContainer = document.getElementById('results-container');
            const filterControls = document.querySelector('.filter-controls');
            const recommendSection = document.getElementById('recommend-tags-section');

            if (!apiKey) { showNotification("API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.", "error"); showApiKeyModal(); return; }
            if (!query) { showNotification("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.", "error"); return; }

            updateSearchHistory(query);
            currentPage = 1;
            allResults = [];
            document.getElementById('pre-search-ad-container').style.display = 'none';
            filterControls.style.display = 'none';
            recommendSection.style.display = 'none';
            resultsContainer.innerHTML = `<div class="loader"><div class="loader-spinner"></div>ê²€ìƒ‰ ì¤‘...</div>`;
            document.getElementById('pagination-controls').innerHTML = '';

            try {
                const res = await fetch(`/search?q=${encodeURIComponent(query)}&apiKey=${apiKey}`);
                const data = await res.json();
                if (!res.ok) { throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì„œë²„ ì˜¤ë¥˜'); }

                const now = new Date();
                allResults = (data.videos || []).map(v => ({ ...v, dailyAverageViews: Math.round(v.viewCount / (Math.max(1, (now - new Date(v.publishedAt)) / 86400000))), lvr: v.viewCount > 0 ? (v.likeCount / v.viewCount * 100).toFixed(2) : 0, cvr: v.viewCount > 0 ? (v.commentCount / v.viewCount * 100).toFixed(2) : 0 }));

                if (allResults.length === 0) {
                    resultsContainer.innerHTML = `<div class="message">ğŸ˜¢ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                } else {
                    filterControls.style.display = 'flex';
                    if (data.recommended_tags && data.recommended_tags.length > 0) {
                        let tagsHTML = `<h4>ğŸ’¡ ì¶”ì²œ íƒœê·¸ (í´ë¦­í•˜ì—¬ ë³µì‚¬)</h4><div>`;
                        data.recommended_tags.forEach(tag => {
                            tagsHTML += `<span class="tag" onclick="copyTagToClipboard(event, '${tag.replace(/'/g, "\\'")}')">${tag}</span>`;
                        });
                        tagsHTML += `</div>
                            <div class="action-buttons">
                                <button class="secondary-action-btn" onclick="openMetricsGuide(event)">ğŸ“Š ì§€í‘œ ë¶„ì„</button>
                                <button class="secondary-action-btn" onclick="downloadCSV()">ğŸ“„ CSV ë‹¤ìš´ë¡œë“œ</button>
                            </div>`;
                        recommendSection.innerHTML = `<div class="recommend-tags-container">${tagsHTML}</div>`;
                        recommendSection.style.display = 'block';
                    }
                    renderData();
                }
            } catch (error) {
                // âœ¨ ìˆ˜ì •ëœ ì˜¤ë¥˜ ì²˜ë¦¬: ì—ëŸ¬ ëª¨ë‹¬ ë„ìš°ê¸°
                showErrorModal(error.message);
                resultsContainer.innerHTML = '';
                filterControls.style.display = 'none';
            }
        }

        function buildAdHTML() {
            const adContent = `<div class="ad-container">ê´‘ê³  ì˜ì—­</div>`;
            if (currentView === 'list') {
                return `<tr class="ad-row"><td colspan="7" class="ad-cell">${adContent}</td></tr>`;
            } else { // Grid View
                return `<div class="ad-card">${adContent}</div>`;
            }
        }

        function renderData() {
            const daysValue = document.getElementById('daysFilter').value;
            const days = daysValue === "" ? 0 : parseFloat(daysValue);

            const subscriberLimitValue = document.getElementById('subscriberFilter').value;
            const subscriberLimit = subscriberLimitValue === "" ? 0 : parseInt(subscriberLimitValue, 10);

            const videoTypeValue = document.getElementById('videoTypeFilter').value;
            const videoType = videoTypeValue === "" ? 'all' : videoTypeValue;

            const filtered = allResults.filter(v => {
                const dateFilter = days === 0 || (new Date() - new Date(v.publishedAt)) / 86400000 <= days;
                const subFilter = subscriberLimit === 0 || (v.channelSubscriberCount != null && v.channelSubscriberCount < subscriberLimit);

                let videoTypeFilter = true;
                if (videoType !== 'all') {
                    const durationInSeconds = parseISO8601Duration(v.duration);
                    if (videoType === 'shorts') {
                        videoTypeFilter = durationInSeconds > 0 && durationInSeconds <= 60;
                    } else if (videoType === 'video') {
                        videoTypeFilter = durationInSeconds > 60;
                    }
                }

                return dateFilter && subFilter && videoTypeFilter;
            });

            const sorted = [...filtered].sort((a, b) => {
                if (sortConfig.key === 'publishedAt') { return sortConfig.direction === 'asc' ? new Date(a.publishedAt) - new Date(b.publishedAt) : new Date(b.publishedAt) - new Date(a.publishedAt); }
                const valA = parseFloat(a[sortConfig.key] || 0); const valB = parseFloat(b[sortConfig.key] || 0);
                return sortConfig.direction === 'asc' ? valA - valB : valB - valA;
            });

            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value, 10) || 50;
            const paginated = sorted.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);
            const container = document.getElementById('results-container');
            container.innerHTML = '';

            if (paginated.length === 0) {
                container.innerHTML = `<div class="message">ğŸ˜¢ í•„í„° ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            } else {
                if (currentView === 'list') {
                    container.innerHTML = buildListHeader();
                    const tableBody = container.querySelector('tbody');
                    paginated.forEach((v, i) => {
                        const rank = (currentPage - 1) * itemsPerPage + i + 1;
                        tableBody.insertAdjacentHTML('beforeend', buildCardHTML(v, rank));
                        if ((i + 1) % 5 === 0 && (i + 1) < paginated.length) {
                            tableBody.insertAdjacentHTML('beforeend', buildAdHTML());
                        }
                    });
                    if (paginated.length > 0) tableBody.insertAdjacentHTML('beforeend', buildAdHTML());
                } else {
                    paginated.forEach((v, i) => {
                        const rank = (currentPage - 1) * itemsPerPage + i + 1;
                        container.insertAdjacentHTML('beforeend', buildCardHTML(v, rank));
                        if ((i + 1) % 5 === 0 && (i + 1) < paginated.length) {
                            container.insertAdjacentHTML('beforeend', buildAdHTML());
                        }
                    });
                    if (paginated.length > 0) container.insertAdjacentHTML('beforeend', buildAdHTML());
                }
            }

            addChannelClickListeners();
            renderPaginationControls(sorted.length);
        }

        function buildListHeader() {
            const headers = [{ key: 'likeCount', label: 'ì¢‹ì•„ìš”' }, { key: 'commentCount', label: 'ëŒ“ê¸€' }, { key: 'viewCount', label: 'ì¡°íšŒìˆ˜' }, { key: 'publishedAt', label: 'ì—…ë¡œë“œ' }];
            let headerHTML = `<table class="results-table"><thead><tr class="list-header"><th class="h-rank">ìˆœìœ„</th><th class="h-info">ì˜ìƒ ì •ë³´</th>`;
            headers.forEach(h => {
                const isActive = sortConfig.key === h.key;
                const arrow = isActive ? (sortConfig.direction === 'asc' ? 'â–²' : 'â–¼') : 'â–¼';
                headerHTML += `<th class="h-stat ${isActive ? 'active' : ''}" data-sort="${h.key}"><div class="header-item-content"><span>${h.label}</span><span class="arrow">${arrow}</span></div></th>`;
            });
            headerHTML += `<th class="h-download">ë‹¤ìš´ë¡œë“œ</th></tr></thead><tbody></tbody></table>`;
            return headerHTML;
        }

        function buildCardHTML(v, rank) {
            const cleanedTitle = v.title ? v.title.replace(/"/g, '&quot;') : '';
            const channelData = JSON.stringify(v).replace(/'/g, "&apos;");

            const publishedDate = new Date(v.publishedAt);
            const formattedDate = `${publishedDate.getFullYear()}. ${publishedDate.getMonth() + 1}. ${publishedDate.getDate()}.`;
            const formattedDateShort = `${publishedDate.getMonth() + 1}ì›” ${publishedDate.getDate()}ì¼`;

            if (currentView === 'list') {
                return `<tr class="video-card-row"><td class="cell rank">${rank}</td><td class="cell info-cell"><div class="thumbnail-container"><a href="${v.videoUrl}" target="_blank"><img src="${v.thumbnail}" loading="lazy"></a></div><div class="info-main"><h3 class="video-title"><a href="${v.videoUrl}" target="_blank" title="${cleanedTitle}">${cleanedTitle}</a></h3><div class="channel-info"><div class="channel-title" data-channel='${channelData}'>${v.channel || 'N/A'}</div></div></div></td><td class="cell stat"><strong>${(v.likeCount || 0).toLocaleString()}</strong><br><span class="rate">(${v.lvr}%)</span></td><td class="cell stat"><strong>${(v.commentCount || 0).toLocaleString()}</strong><br><span class="rate">(${v.cvr}%)</span></td><td class="cell stat"><strong>${(v.viewCount || 0).toLocaleString()}</strong><br><span class="rate">${v.dailyAverageViews.toLocaleString()}/ì¼</span></td><td class="cell stat"><strong>${formattedDate}</strong></td><td class="cell download-cell"><a href="#" class="download-icon" title="ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ" onclick="event.preventDefault(); downloadThumbnail('${v.thumbnail}', '${cleanedTitle.replace(/'/g, "\\'")}');">${downloadIconSVG}</a></td></tr>`;
            } else {
                return `<div class="video-card"><div class="thumbnail-container"><a href="${v.videoUrl}" target="_blank"><img src="${v.thumbnail}" loading="lazy"></a><a href="#" class="download-icon-grid" title="ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ" onclick="event.preventDefault(); downloadThumbnail('${v.thumbnail}', '${cleanedTitle.replace(/'/g, "\\'")}');">${downloadIconSVG}</a></div><div class="info-main"><h3 class="video-title"><a href="${v.videoUrl}" target="_blank" title="${cleanedTitle}">${cleanedTitle}</a></h3><div class="channel-title" data-channel='${channelData}'>${v.channel}</div></div><div class="stat-grid"><div><b>${(v.viewCount || 0).toLocaleString()}</b><br>ì¡°íšŒìˆ˜</div><div><b>${(v.likeCount || 0).toLocaleString()}</b><br>ì¢‹ì•„ìš”</div><div><b>${formattedDateShort}</b><br>ì—…ë¡œë“œ</div></div></div>`;
            }
        }

        function addChannelClickListeners() {
            document.querySelectorAll('.channel-title').forEach(el => {
                el.addEventListener('click', (event) => {
                    event.stopPropagation();
                    try {
                        const videoData = JSON.parse(event.currentTarget.dataset.channel.replace(/'/g, "'"));
                        if (videoData) {
                            showCustomTooltip(event.currentTarget, videoData);
                        }
                    } catch (e) { console.error("Could not parse video data for tooltip", e); }
                });
            });
        }

        async function downloadThumbnail(url, title) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${title.replace(/[\\/:*?"<>|]/g, '')}_thumbnail.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                showNotification("ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error");
            }
        }

        function downloadCSV() {
            const dataToDownload = allResults;
            if (dataToDownload.length === 0) { showNotification("ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.", "error"); return; }
            const headers = ["ì œëª©", "ì±„ë„", "ì¢‹ì•„ìš”", "ëŒ“ê¸€", "ì´ì¡°íšŒìˆ˜", "ì—…ë¡œë“œ ë‚ ì§œ", "ì˜ìƒ URL"];
            let csvContent = headers.join(',') + '\n';
            dataToDownload.forEach((v) => {
                const title = `"${(v.title || '').replace(/"/g, '""')}"`;
                const channel = `"${(v.channel || '').replace(/"/g, '""')}"`;
                const publishedDate = new Date(v.publishedAt).toLocaleDateString('ko-KR');
                const row = [title, channel, v.likeCount, v.commentCount, v.viewCount, publishedDate, v.videoUrl];
                csvContent += row.join(',') + '\n';
            });
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "youtube_analysis_results.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyTagToClipboard(event, tagText) {
            navigator.clipboard.writeText(tagText).then(() => {
                const notif = document.createElement('div');
                notif.className = 'tag-copy-notification';
                notif.textContent = `'${tagText}' ë³µì‚¬ ì™„ë£Œ!`;
                document.body.appendChild(notif);

                const targetRect = event.target.getBoundingClientRect();
                notif.style.left = `${targetRect.left + window.scrollX}px`;
                notif.style.top = `${targetRect.top + window.scrollY - notif.offsetHeight - 5}px`;

                setTimeout(() => {
                    notif.classList.add('show');
                }, 10);

                setTimeout(() => {
                    notif.classList.remove('show');
                    setTimeout(() => {
                        notif.remove();
                    }, 300);
                }, 1500);

            }, (err) => {
                showNotification('íƒœê·¸ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', "error");
            });
        }

        function toggleViewMode() { currentView = (currentView === 'list') ? 'grid' : 'list'; localStorage.setItem('youtubeSearchView', currentView); applyViewMode(); if (allResults.length > 0) renderData(); }

        function applyViewMode() {
            const btn = document.getElementById('view-toggle-btn');
            const container = document.getElementById('results-container');
            if (container) { container.className = currentView === 'grid' ? 'grid-view' : ''; }
            if (btn) { btn.innerHTML = viewIcons[currentView]; btn.title = currentView === 'list' ? 'ê·¸ë¦¬ë“œ ë³´ê¸°' : 'ë¦¬ìŠ¤íŠ¸ ë³´ê¸°'; }
        }
        function setSort(key) { if (sortConfig.key === key) { sortConfig.direction = sortConfig.direction === 'desc' ? 'asc' : 'desc'; } else { sortConfig.key = key; sortConfig.direction = 'desc'; } currentPage = 1; renderData(); }
        function changeItemsPerPage() {
            const itemsPerPageValue = document.getElementById('itemsPerPage').value;
            itemsPerPage = itemsPerPageValue === "" ? 50 : parseInt(itemsPerPageValue, 10);
            currentPage = 1;
            renderData();
        }

        function renderPaginationControls(totalItems) {
            const pageCount = Math.ceil(totalItems / itemsPerPage);
            const controls = document.getElementById('pagination-controls');
            controls.innerHTML = '';
            if (pageCount <= 1) return;
            for (let i = 1; i <= pageCount; i++) { const button = document.createElement('button'); button.innerText = i; button.className = (i === currentPage) ? 'active' : ''; button.onclick = () => { currentPage = i; renderData(); window.scrollTo(0, 0); }; controls.appendChild(button); }
        }

        function showCustomTooltip(targetElement, videoData) {
            const tooltip = document.getElementById('custom-tooltip');
            const tooltipContent = document.getElementById('tooltip-content');
            if (!tooltip || !tooltipContent) return;

            if (activeTooltipTarget === targetElement) {
                hideCustomTooltip();
                return;
            }

            let statsHtml = `<h4>${videoData.channel} ì±„ë„ ì •ë³´</h4>`;
            let subscriberText = videoData.channelSubscriberCount != null ? `${videoData.channelSubscriberCount.toLocaleString()}ëª…` : 'ë¹„ê³µê°œ';
            statsHtml += `<p><b>êµ¬ë…ì:</b> ${subscriberText}</p>`;
            if (videoData.channelTotalVideos != null) {
                statsHtml += `<p><b>ì´ ì˜ìƒ:</b> ${videoData.channelTotalVideos.toLocaleString()}ê°œ</p>`;
                statsHtml += `<p><b>ì´ ì¡°íšŒìˆ˜:</b> ${videoData.channelTotalViews.toLocaleString()}íšŒ</p>`;
                statsHtml += `<p><b>ì˜ìƒë‹¹ í‰ê·  ì¡°íšŒìˆ˜:</b> ${videoData.channelAvgViews.toLocaleString()}íšŒ</p>`;
            }
            tooltipContent.innerHTML = statsHtml;

            const targetRect = targetElement.getBoundingClientRect();

            tooltip.style.left = `${targetRect.left + window.scrollX + (targetRect.width / 2)}px`;
            tooltip.style.top = `${targetRect.top + window.scrollY}px`;
            tooltip.style.transform = 'translate(-50%, -100%)';
            tooltip.style.marginTop = '-10px';

            tooltip.classList.add('show');
            activeTooltipTarget = targetElement;
        }

        function hideCustomTooltip() {
            const tooltip = document.getElementById('custom-tooltip');
            if (!tooltip) return;
            tooltip.classList.remove('show');
            activeTooltipTarget = null;
        }

        function enlargeImage(imgElement) {
            const lightbox = document.getElementById('image-lightbox');
            if (lightbox) {
                const lightboxImg = lightbox.querySelector('img');
                lightboxImg.src = imgElement.src;
                lightbox.classList.add('show');
            }
        }

        function closeImageLightbox() {
            const lightbox = document.getElementById('image-lightbox');
            if (lightbox) {
                lightbox.classList.remove('show');
            }
        }
    </script>
</body>

</html>